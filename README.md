# 京都将棋AI

[第59回プログラミング・シンポジウム][]の参加中に作った[京都将棋][]のAIです。

[第59回プログラミング・シンポジウム]: http://www.ipsj.or.jp/prosym/59/59CFA.html
[京都将棋]: https://ja.wikipedia.org/wiki/京都将棋

## 京都将棋とは？

  - 5×5の盤面で行う変則将棋です。
  - 駒の動きは本将棋と同一です。
  - 王以外の駒は移動する度に駒が裏返ります。
    * そのため成るという概念はありません。
  - 初期配置はお互いに自分の手元に左から`と銀王金歩`です。（と金がいきなり自陣にあるだと!?）
  - 駒の表裏が本将棋と異なります。
    * `香`の裏が`と`、`銀`の裏が`角`、`金`の裏が`桂`、`歩`の裏が`飛`です。
  - 二歩とか動けなくなる駒の禁止とか歩詰めの禁止はありません。千日手はあるらしいです。
  - 総ずると変な将棋です。

詳しくは[Wikipediaの記事][京都将棋]を参考にしてください。

## 特徴

  - ただのalpha-beta法の実装です。とりわけ工夫はしていません。
  - 評価関数は適当に駒損を計算します。
    * 表裏の駒に別々の評価値を割り当てています。
    * 持ち駒は表裏の平均としています。
  - デフォルトだと7手ぐらい先読みします。

## 使い方

コンパイルは`make`を叩いてください。

```console
$ make
```

`ks`という実行可能ファイルが出来ているので、それを実行してください。

```console
$ ./ks
  | 0 | 1 | 2 | 3 | 4 |
--+---+---+---+---+---+
0 |▽歩|▽金|▽王|▽銀|▽と|
--+---+---+---+---+---+
1 |   |   |   |   |   |
--+---+---+---+---+---+
2 |   |   |   |   |   |
--+---+---+---+---+---+
3 |   |   |   |   |   |
--+---+---+---+---+---+
4 |▲と|▲銀|▲王|▲金|▲歩|
>>>
```

`>>>`は入力待ちのプロンプトです。ここにコマンドを入力することでターンを進めていきます。
コマンドは以下のものがあります。

  - `move fx fy tx ty`: `fx`×`fy`の位置にある駒を`tx`×`ty`の位置に移動する。（例: `move 1 4 2 3`。`1`×`4`の位置にある駒、すなわち銀を`2`×`3`の位置に移動する。）
    * 入力値のバリデーションが足りないので、あり得ない駒の動きを受け入れてしまうことに注意してください。
  - `use x y 駒`: `x`×`y`の位置に持ち駒の`駒`を置きます。`駒`は`歩`・`と`・角などの日本語の名前で指定します。（例: `use 3 2 桂`。桂が持ち駒にあるとして、`3`×`2`の位置に`桂`を配置する。）

相手のターンは自動で進みます。盤面の状況によっては少し時間がかかることがあるかもしれません。

今のところどちらかの`王`が取られるまで終わらないのでがんばってください。
千日手は検出しないので自力で気付いてください。

最後に、先攻・後攻は`ks`に渡すコマンドライン引数で変更できます。

  - `-1`が渡された場合は先攻になります（デフォルト）。
  - `-2`が渡された場合は後攻になります。

## TODO

全力で未完成。下に行くほど大変な気がする。

  - 駒の移動の際のバリデーションをちゃんとやる。
  - 入力のバリデーションをもっとやる。現状バッファオバーフローできるくるので。
  - AI同士の対戦ができるようにする。
    * 強さを相対的に概観できるようにするため。
  - 駒の位置による評価値の調整をする。
  - 千日手の検出をする。
  - 既存の将棋AIの手法の検討、実装をする。

## 歴史

歴史を記録することには一定の価値があります（宣言的知識）。

  - 2018/01/19:
    * 京都将棋のルールを聞いてAIを実装してみたいと思う。しかしAIを実装する知識などボクは持たなかった。
  - 2018/01/20:
    * [京都将棋のAIを一晩で実装した方](http://sun.ac.jp/researchinfo/yamagu/)が現れる。一晩で実装できるものだということを知ったので俄然実装しようという気持ちになる。
    * 日本酒を呑む。
    * 調子に乗って実装しようなどと譫言を言い始める。
  - 2018/01/21:
    * 深夜、実装を始める（1時くらい）。
    * alpha-beta法というのがいいらしいのでWikipediaの記事を参考に実装をする。
    * よく分からないけど動くものができたので寝る（5時くらい）。
    * 朝起きて見ると色々とひどかったので発表を聞きつつ修正する。
      + 一番ひどかったのは飛車と角行と香車が駒を越えて飛んでくるバグと、各行が自身の周囲2マスのどこにでも飛んで行くバグ。
      + このせいでAIがこちらをなめた打ち方をしてきて大変愉快だった。
      + alpha-beta法で`max`/`min`を取らずに常に返ってきた値を利用するバグもあった気がする。
      + このことによる学びは、人は酒を呑んでから深夜にコードを書くことは難しいということであった。
  - 2018/01/23
    * 公開しようと思い立つ。
    * 公開する。

## ライセンス

MIT <https://makenowjust.mit-license.org/2018>

あと寿司 :sushi: <https://github.com/MakeNowJust/sushi-ware>
